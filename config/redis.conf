# Redis Configuration for RAG-Enhanced Threat Hunter Pro
# Optimized for caching and session management

# =============================================================================
# Network and Security
# =============================================================================

# Bind to all interfaces within the Docker network
bind 0.0.0.0

# Port configuration
port 6379

# Connection timeout
timeout 0

# TCP keepalive
tcp-keepalive 300

# =============================================================================
# Memory Management
# =============================================================================

# Maximum memory usage (will be overridden by Docker limits)
maxmemory 512mb

# Memory eviction policy for caching use case
maxmemory-policy allkeys-lru

# =============================================================================
# Persistence Configuration
# =============================================================================

# Enable RDB snapshots for data persistence
save 900 1    # Save if at least 1 key changed in 900 seconds
save 300 10   # Save if at least 10 keys changed in 300 seconds
save 60 10000 # Save if at least 10000 keys changed in 60 seconds

# RDB file name
dbfilename dump.rdb

# Directory for persistence files
dir /data

# Compress RDB files
rdbcompression yes

# Checksum RDB files
rdbchecksum yes

# =============================================================================
# Logging Configuration
# =============================================================================

# Log level (debug, verbose, notice, warning)
loglevel notice

# Log to stdout for Docker
logfile ""

# =============================================================================
# Performance Tuning
# =============================================================================

# Disable protected mode (safe within Docker network)
protected-mode no

# TCP listen backlog
tcp-backlog 511

# Client output buffer limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Hash table size optimization
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# List optimization
list-max-ziplist-size -2
list-compress-depth 0

# Set optimization
set-max-intset-entries 512

# Sorted set optimization
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# =============================================================================
# Slow Log Configuration
# =============================================================================

# Log queries slower than 10ms
slowlog-log-slower-than 10000

# Keep last 128 slow queries
slowlog-max-len 128

# =============================================================================
# Advanced Configuration
# =============================================================================

# Lazy freeing for better performance
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes

# IO threads for better performance (Redis 6+)
io-threads 2
io-threads-do-reads yes

# Enable active rehashing
activerehashing yes

# Minimum time between flushes
hz 10